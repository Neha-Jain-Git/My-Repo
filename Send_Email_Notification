- name: Update LAST_GOOD_SHA_DDIQA in Environment
        run: |
          OWNER=${{ github.repository_owner }}
          REPO=$(echo "${{ github.repository }}" | cut -d'/' -f2)
          REPO_ID=$(curl -s -H "Authorization: token ${{ secrets.PAT_TOKEN }}" \
            https://api.github.com/repos/$OWNER/$REPO | jq -r .id)

          ENVIRONMENT="DDIQA"
          VARIABLE_NAME="LAST_GOOD_SHA_DDIQA"
          NEW_VALUE=$(git rev-parse HEAD)

          echo "NEW_VALUE: $NEW_VALUE"

          RESPONSE=$(curl -s -o response.json -w "%{http_code}" -X PATCH \
            -H "Authorization: token ${{ secrets.PAT_TOKEN }}" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/repositories/$REPO_ID/environments/$ENVIRONMENT/variables/$VARIABLE_NAME \
            -d "{\"name\":\"$VARIABLE_NAME\",\"value\":\"$NEW_VALUE\"}")

          echo "RESPONSE: $RESPONSE"
          if [[ "$RESPONSE" -ge 200 && "$RESPONSE" -lt 300 ]]; then
            echo "✅ Successfully updated $VARIABLE_NAME."
          else
            echo "❌ Failed to update $VARIABLE_NAME. HTTP status: $RESPONSE"
            cat response.json
          fi