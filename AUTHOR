- name: Extract Failed File Authors
        id: authors
        if: needs.deploy-on-merge.outputs.deploy_status == 'Failed'
        run: |
          touch authors.txt
          
          # Normalize failed file paths to match repo structure
          while IFS= read -r file; do
            if [ -f "$file" ]; then
              # File exists as-is
              git log -1 --pretty=format:'%ae' -- "$file" >> authors.txt || true
            elif [ -f "force-app/main/default/$file" ]; then
              # File exists inside force-app/main/default/
              git log -1 --pretty=format:'%ae' -- "force-app/main/default/$file" >> authors.txt || true
            else
              echo "⚠️ Could not map $file to repo file" >&2
            fi
          done < failed-files.txt
          
          sort -u authors.txt > unique-authors.txt
          echo "authors=$(paste -sd ',' unique-authors.txt)" >> $GITHUB_OUTPUT
          echo "authors=$(paste -sd ',' unique-authors.txt)"